<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="theme-color" content="#FFFCF2">
    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#FFFCF2">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#000000">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Timetable</title>
    <link rel="icon" type="image/png" href="../favicon.png">
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=Space+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css" rel="stylesheet">
    <script src="https://apis.google.com/js/api.js" async defer></script>
    <script>
        (function () {
            const theme = localStorage.getItem('theme-preference') || 'auto';
            if (theme !== 'auto') {
                document.documentElement.setAttribute('data-theme', theme);
            }
        })();
    </script>

    <style>
        :root {
            --primary-color: #0b91ff;
            --secondary-color: #FFBE0B;
            --tertiary-color: #3A86FF;
            --accent-color: #8338EC;
            --success-color: #06FFB4;
            --dark-color: #0D0D0D;
            --light-color: #FFFCF2;
            --gray-color: #C4C4C4;
            --border-width: 4px;
            --shadow-offset: 8px;

            --dark-bg: #000000;
            --dark-surface: #1a1a1a;
            --dark-surface-light: #3a3a3a;
            --dark-text: #f0f0f0;
            --dark-text-muted: #b0b0b0;
            --dark-border: #4a4a4a;

            --primary-shadow: var(--shadow-offset) var(--shadow-offset) 0 var(--primary-color);
            --secondary-shadow: var(--shadow-offset) var(--shadow-offset) 0 var(--secondary-color);
            --tertiary-shadow: 4px 4px 0 var(--tertiary-color);
            --default-shadow: 4px 4px 0 var(--dark-color);
            --default-border: var(--border-width) solid var(--dark-color);
        }

        *,
        *::before,
        *::after {
            box-sizing: border-box;
            transition: transform .2s cubic-bezier(.68, -.55, .265, 1.55), box-shadow .2s ease, background-color .3s ease, border-color .2s ease;
        }

        html {
            scroll-behavior: smooth;
            background-color: var(--light-color);
        }

        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            font-family: 'Space Grotesk', sans-serif;
            color: var(--dark-color);
            position: relative;
            overflow-x: hidden;
        }

        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .main-content-wrapper {
            flex-grow: 1;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-image:
                repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255, 0, 110, .03) 35px, rgba(255, 0, 110, .03) 70px),
                repeating-linear-gradient(-45deg, transparent, transparent 35px, rgba(255, 190, 11, .03) 35px, rgba(255, 190, 11, .03) 70px);
            pointer-events: none;
            z-index: -1;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        .course-header,
        .info-item,
        .progress-bar,
        button,
        .footer,
        .category-button,
        .timetable-button,
        .iframe-container,
        #cat-speech-bubble {
            border-radius: 8px;
        }

        .course-header {
            background: var(--light-color);
            border: var(--default-border);
            padding: 40px;
            margin-bottom: 20px;
            position: relative;
            transform: rotate(-.5deg);
            box-shadow: var(--primary-shadow);
        }

        h1 {
            margin: 0 0 15px 0;
            font-weight: 700;
            font-size: 3.5em;
            line-height: .9;
            letter-spacing: -3px;
            text-transform: uppercase;
            background: linear-gradient(45deg, var(--primary-color), var(--accent-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        h2 {
            margin: 0 0 10px 0;
            font-weight: 700;
            font-size: 1.2em;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--dark-color);
        }

        .course-info {
            display: flex;
            flex-wrap: wrap;
            margin-top: 20px;
            margin-bottom: 15px;
            gap: 10px;
            align-items: center;
        }

        .info-item {
            background: var(--light-color);
            border: 3px solid var(--dark-color);
            padding: 10px 16px;
            font-size: .9em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: inline-flex;
            align-items: center;
            position: relative;
            box-shadow: var(--tertiary-shadow);
        }

        .info-item i {
            margin-right: 8px;
            color: var(--primary-color);
        }

        .progress-bar {
            background: var(--light-color);
            height: 20px;
            border: var(--border-width) solid var(--dark-color);
            margin: 20px 0;
            overflow: hidden;
            position: relative;
        }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(90deg, transparent, transparent 10px, rgba(0, 0, 0, .1) 10px, rgba(0, 0, 0, .1) 20px);
            z-index: 2;
            animation: stripes-move 30s linear infinite;
        }

        @keyframes stripes-move {
            0% {
                background-position: 0 0;
            }

            100% {
                background-position: 200px 0;
            }
        }

        .progress {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
            transition: width .5s cubic-bezier(.68, -.55, .265, 1.55);
            position: relative;
            z-index: 1;
        }

        /* Buttons */
        button {
            display: inline-block;
            background: var(--primary-color);
            color: var(--light-color);
            padding: 12px 24px;
            text-decoration: none;
            font-size: .9em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all .2s cubic-bezier(.68, -.55, .265, 1.55);
            text-align: center;
            border: var(--border-width) solid var(--dark-color);
            box-shadow: 4px 4px 0 var(--dark-color);
            -webkit-user-select: none;
            -khtml-user-select: none;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        button:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 var(--dark-color);
        }

        button:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 var(--dark-color);
        }

        button:disabled {
            opacity: .5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-green {
            background: var(--success-color);
            color: var(--dark-color);
        }

        .btn-orange {
            background: var(--secondary-color);
            color: var(--dark-color);
        }

        .btn-blue {
            background: var(--tertiary-color);
        }

        .btn-purple {
            background: var(--accent-color);
        }

        .btn-primary {
            background: var(--primary-color);
        }

        .category-button i {
            margin-right: 6px;
        }

        .course-actions {
            padding: 5px;
            display: flex;
            justify-content: flex-start;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .footer {
            max-width: 1100px;
            text-align: center;
            padding: 40px 20px;
            margin: 50px auto 20px;
            background: var(--dark-color);
            color: var(--light-color);
            border: var(--border-width) solid var(--dark-color);
            position: relative;
            transform: rotate(-.5deg);
            box-shadow: var(--shadow-offset) var(--shadow-offset) 0 var(--primary-color);
            -webkit-user-select: none;
            -khtml-user-select: none;
        }

        .footer::before {
            content: '';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%) rotate(45deg);
            width: 40px;
            height: 40px;
            background: var(--secondary-color);
            border: var(--border-width) solid var(--dark-color);
        }

        .social-links {
            margin: 20px 0;
        }

        .social-links a {
            color: var(--light-color);
            font-size: 1.5em;
            margin: 0 15px;
            transition: all .3s ease;
            display: inline-block;
        }

        .social-links a:hover {
            color: var(--secondary-color);
            transform: rotate(216.00deg) scale(1.3);
        }

        .category-buttons-container {
            padding: 5px;
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .category-button {
            background: var(--light-color);
            color: var(--dark-color);
            border: var(--border-width) solid var(--dark-color);
            padding: 10px 16px;
            font-size: .95em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all .2s cubic-bezier(.68, -.55, .265, 1.55);
            -webkit-user-select: none;
            -khtml-user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            box-shadow: 4px 4px 0 var(--gray-color);
            overflow: hidden;
        }

        .category-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: var(--secondary-color);
            transition: width .3s ease;
            z-index: -1;
        }

        .category-button:hover::before {
            width: 100%;
        }

        .category-button:hover {
            transform: translateX(5px) rotate(-1.00deg);
            box-shadow: 6px 6px 0 var(--dark-color);
        }

        .category-button.active {
            background: var(--primary-color);
            color: var(--light-color);
            box-shadow: 6px 6px 0 var(--dark-color);
            transform: rotate(-1.00deg);
        }

        .category-button.active::before {
            width: 100%;
            background: var(--accent-color);
        }

        .category-content {
            display: none;
        }

        .category-content.active {
            display: block;
        }

        .timetable-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding-top: 5px;
            margin-top: 10px;
        }

        .timetable-button {
            display: inline-block;
            background: var(--primary-color);
            color: var(--light-color);
            padding: 12px 24px;
            text-decoration: none;
            font-size: .9em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all .2s cubic-bezier(.68, -.55, .265, 1.55);
            text-align: center;
            border: var(--border-width) solid var(--dark-color);
            box-shadow: 4px 4px 0 var(--dark-color);
            -webkit-user-select: none;
            -khtml-user-select: none;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .timetable-button:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 var(--dark-color);
        }

        .timetable-button:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 var(--dark-color);
        }

        .timetable-button:disabled {
            opacity: .5;
            cursor: not-allowed;
            transform: none;
        }

        .iframe-container {
            width: 100%;
            height: 0;
            position: relative;
            overflow: hidden;
            opacity: 0;
            transition: opacity .5s ease-in-out, height .5s ease-in-out;
            border: var(--border-width) solid var(--dark-color);
            box-shadow: var(--shadow-offset) var(--shadow-offset) 0 var(--tertiary-color);
            margin-top: 20px;
            background: var(--light-color);
        }

        .iframe-container.active {
            height: 600px;
            opacity: 1;
        }

        .iframe-container:not(.active) {
            pointer-events: none;
        }

        #timetable-iframe {
            width: 100%;
            height: 1440px;
            border: none;
            position: absolute;
            transform: translateY(-110px);
        }

        #lecturer-iframe {
            width: 100%;
            height: 1000px;
            border: none;
            position: absolute;
            transform: translateY(-150px);
        }

        .main-content-wrapper {
            position: relative;
        }

        #skeleton-loader {
            position: absolute;
            inset: 0;
            z-index: 10;
        }

        body:not(.is-loading) #skeleton-loader {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            display: none;
            transition: opacity 0.3s ease, visibility 0s 0.3s;
        }

        body.is-loading #main-container,
        body.is-loading .footer,
        body.is-loading #cat-companion {
            visibility: hidden;
        }

        .skeleton-spinner-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 11;
            text-align: center;
        }

        #spinner-image {
            width: 150px;
            height: 150px;
            opacity: 0;
            transition: opacity 0.3s ease-in;
            filter:
                drop-shadow(2px 2px 0 var(--dark-color)) drop-shadow(-2px -2px 0 var(--dark-color)) drop-shadow(2px -2px 0 var(--dark-color)) drop-shadow(-2px 2px 0 var(--dark-color)) drop-shadow(6px 6px 0 var(--accent-color));
        }

        #spinner-image.loaded {
            opacity: 1;
        }

        #loading-text {
            font-family: 'Space Mono', monospace;
            font-weight: 700;
            margin-top: 10px;
            color: var(--dark-color);
        }

        @keyframes shimmer {
            100% {
                transform: translateX(100%);
            }
        }

        .skeleton {
            position: relative;
            overflow: hidden;
            background-color: #fffcf2;
            border-radius: 8px;
        }

        .skeleton::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            transform: translateX(-100%);
            background-image: linear-gradient(90deg, transparent, rgba(0, 0, 0, 0.04), transparent);
            animation: shimmer 1.5s infinite;
        }

        .skeleton-header {
            padding: 40px;
            margin-bottom: 30px;
        }

        .skeleton-h1 {
            height: 60px;
            width: 80%;
            margin-bottom: 15px;
        }

        .skeleton-h2 {
            height: 20px;
            width: 30%;
            margin-bottom: 10px;
        }

        .skeleton-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }

        .skeleton-button {
            height: 48px;
            flex: 1 1 120px;
        }

        /* Theme toggle in footer*/
        .footer-tools {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 5px;
        }

        .footer-tools button {
            border-radius: 50%;
        }

        .theme-toggle {
            width: 40px;
            height: 40px;
            padding: 0;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: 4px solid var(--dark-color);
            background: var(--light-color);
            color: var(--dark-color);
            box-shadow: 3px 3px 0 rgba(0, 0, 0, .4);
            cursor: pointer;
            transition: transform .15s ease, box-shadow .15s ease, background-color .2s ease, color .2s ease, border-color .2s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1);
            /* Makes the button 10% larger on hover */
            box-shadow: 4px 4px 0 rgba(0, 0, 0, .4);
        }

        .theme-toggle:active {
            transform: scale(0.95);
            /* Briefly shrinks the button when clicked */
            box-shadow: 1px 1px 0 rgba(0, 0, 0, .4);
        }

        @keyframes cat-idle {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-3px);
            }
        }

        #cat-companion {
            position: fixed;
            bottom: 0;
            right: 20px;
            bottom: env(safe-area-inset-bottom, 0);
            /* Mobile safe area */
            z-index: 1000;
            cursor: pointer;
        }

        #cat-image {
            width: 150px;
            height: auto;
            animation: cat-idle 2.5s ease-in-out infinite;
            filter: drop-shadow(4px 4px 0 var(--dark-color));
            transition: transform 0.2s ease;
        }

        #cat-speech-bubble {
            position: absolute;
            bottom: 100px;
            -webkit-hyphens: auto;
            /* For Safari */
            hyphens: auto;
            /* Position above the cat */
            right: 0;
            width: 200px;
            border-radius: 8px;
            padding: 15px;
            background: var(--light-color);
            border: var(--border-width) solid var(--dark-color);
            box-shadow: var(--default-shadow);
            font-size: 0.9em;
            font-weight: 700;
            opacity: 0;
            transform: translateY(10px) scale(0.9);
            pointer-events: none;
            transition: all 0.2s cubic-bezier(.68, -.55, .265, 1.55);
        }

        /* The little triangle for the speech bubble */
        #cat-speech-bubble::after {
            content: '';
            position: absolute;
            bottom: -22px;
            right: 20px;
            border: 8px solid transparent;
            border-top-color: var(--dark-color);
        }

        #cat-speech-bubble.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
        }

        /* --- DARK THEME STYLES --- */

        /* --- 1. Styles for when data-theme="dark" is set manually --- */

        html[data-theme="dark"] {
            background-color: var(--dark-bg);
        }

        html[data-theme="dark"] body {
            color: var(--dark-text);
            background-color: var(--dark-bg);
            background-image:
                repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255, 255, 255, .03) 35px, rgba(255, 255, 255, .03) 70px),
                repeating-linear-gradient(-45deg, transparent, transparent 35px, rgba(255, 255, 255, .03) 35px, rgba(255, 255, 255, .03) 70px);
        }

        html[data-theme="dark"] :is(.course-header, .category-button, .timetable-button, .info-item, .progress-bar, .iframe-container, .theme-toggle, #cat-speech-bubble, .skeleton, h2, .btn-orange) {
            background: var(--dark-surface);
            color: var(--dark-text);
            border-color: var(--dark-border);
        }

        html[data-theme="dark"] #loading-text {
            color: var(--dark-text);
        }

        /* Note: .footer is dark by default and doesn't need this rule */
        html[data-theme="dark"] .footer {
            background: var(--dark-surface);
            /* Ensures consistency */
            border-color: var(--dark-border);
        }

        html[data-theme="dark"] {
            --default-border: var(--border-width) solid var(--dark-border);
        }

        html[data-theme="dark"] button,
        html[data-theme="dark"] #cat-speech-bubble {
            box-shadow: 4px 4px 0 var(--dark-border);
        }

        html[data-theme="dark"] button:hover {
            box-shadow: 6px 6px 0 var(--dark-border);
        }

        html[data-theme="dark"] .category-button {
            box-shadow: 4px 4px 0 var(--gray-color);
        }

        html[data-theme="dark"] .category-button:hover,
        html[data-theme="dark"] .category-button.active {
            box-shadow: 6px 6px 0 var(--dark-border);
        }

        html[data-theme="dark"] .btn-orange {
            color: var(--dark-text);
            background: var(--secondary-color);
        }

        html[data-theme="dark"] .timetable-button.active {
            color: var(--light-color);
            background: var(--tertiary-color);
        }

        html[data-theme="dark"] .footer::before {
            border-color: var(--dark-border);
        }

        html[data-theme="dark"] #cat-speech-bubble::after {
            border-top-color: var(--dark-border);
        }

        html[data-theme="dark"] #cat-image {
            filter: drop-shadow(4px 4px 0 var(--dark-border));
        }

        html[data-theme="dark"] .skeleton::after {
            background-image: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.08), transparent);
        }


        /* --- 2. Styles for when OS theme is dark (auto mode) --- */

        @media (prefers-color-scheme: dark) {
            html:not([data-theme="light"]) {
                background-color: var(--dark-bg);
            }

            html:not([data-theme="light"]) body {
                color: var(--dark-text);
                background-color: var(--dark-bg);
                background-image:
                    repeating-linear-gradient(45deg, transparent, transparent 35px, rgba(255, 255, 255, .03) 35px, rgba(255, 255, 255, .03) 70px),
                    repeating-linear-gradient(-45deg, transparent, transparent 35px, rgba(255, 255, 255, .03) 35px, rgba(255, 255, 255, .03) 70px);
            }

            html:not([data-theme="light"]) :is(.course-header, .category-button, .timetable-button, .info-item, .progress-bar, .iframe-container, .theme-toggle, #cat-speech-bubble, .skeleton, h2, .btn-orange) {
                background: var(--dark-surface);
                color: var(--dark-text);
                border-color: var(--dark-border);
            }

            html:not([data-theme="light"]) #loading-text {
                color: var(--dark-text);
            }

            html:not([data-theme="light"]) .footer {
                background: var(--dark-surface);
                border-color: var(--dark-border);
            }

            html:not([data-theme="light"]) {
                --default-border: var(--border-width) solid var(--dark-border);
            }

            html:not([data-theme="light"]) button,
            html:not([data-theme="light"]) #cat-speech-bubble {
                box-shadow: 4px 4px 0 var(--dark-border);
            }

            html:not([data-theme="light"]) button:hover {
                box-shadow: 6px 6px 0 var(--dark-border);
            }

            html:not([data-theme="light"]) .category-button {
                box-shadow: 4px 4px 0 var(--gray-color);
            }

            html:not([data-theme="light"]) .category-button:hover,
            html:not([data-theme="light"]) .category-button.active {
                box-shadow: 6px 6px 0 var(--dark-border);
            }

            html:not([data-theme="light"]) .btn-orange {
                color: var(--dark-text);
                background: var(--secondary-color);
            }

            html:not([data-theme="light"]) .timetable-button.active {
                color: var(--light-color);
                background: var(--tertiary-color);
            }

            html:not([data-theme="light"]) .footer::before {
                border-color: var(--dark-border);
            }

            html:not([data-theme="light"]) #cat-speech-bubble::after {
                border-top-color: var(--dark-border);
            }

            html:not([data-theme="light"]) #cat-image {
                filter: drop-shadow(4px 4px 0 var(--dark-border));
            }

            html:not([data-theme="light"]) .skeleton::after {
                background-image: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.08), transparent);
            }
        }

        .is-scrollable {
            -webkit-mask-image: linear-gradient(to right, transparent, black 20px, black 95%, transparent);
            mask-image: linear-gradient(to right, transparent, black 20px, black 95%, transparent);
        }

        .is-scrollable.at-start {
            -webkit-mask-image: linear-gradient(to right, black 95%, transparent);
            mask-image: linear-gradient(to right, black 95%, transparent);
        }

        .is-scrollable.at-end {
            -webkit-mask-image: linear-gradient(to right, transparent, black 20px, black 100%);
            mask-image: linear-gradient(to right, transparent, black 20px, black 100%);
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .course-header {
                padding: 25px 20px;
                transform: none !important;
            }

            .footer {
                transform: none !important;
            }

            h1 {
                font-size: 2.2em !important;
                margin-bottom: 10px;
                /* Add this line */
            }

            h2 {
                font-size: 1.1em;
                margin-bottom: 8px;
            }

            .course-info {
                margin-top: 15px;
            }

            .course-actions,
            .category-buttons-container,
            .timetable-buttons,
            .course-info {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                padding-bottom: 15px;
                /* Increased for better touch scrolling */
                scrollbar-width: none;
                min-width: 0;
                /* A fix to ensure flex containers respect parent's width */
            }

            .course-actions::-webkit-scrollbar,
            .category-buttons-container::-webkit-scrollbar,
            .timetable-buttons::-webkit-scrollbar,
            .course-info::-webkit-scrollbar {
                display: none;
            }

            .course-actions button,
            .category-button,
            .timetable-button,
            .info-item {
                flex-shrink: 0;
            }

            .course-actions button {
                padding: 8px 12px;
                font-size: .8em;
            }

            .category-button {
                padding: 10px 16px;
                font-size: .85em;
            }

            .timetable-buttons,
            .course-info {
                gap: 8px;
            }

            .timetable-button,
            .info-item {
                padding: 8px 12px;
                font-size: 0.8em;
            }

            #cat-companion {
                display: none;
            }
        }
    </style>

</head>

<body class="is-loading">

    <div class="main-content-wrapper">

        <div id="skeleton-loader">
            <div class="skeleton-spinner-container">
                <img src="" alt="Loading..." id="spinner-image">
                <div id="loading-text"></div>
            </div>
            <div class="container">
                <div class="skeleton-actions">
                    <div class="skeleton skeleton-button"></div>
                    <div style="flex-grow: 1;"></div>
                    <div class="skeleton skeleton-button" style="flex-grow: 0; width: 120px;"></div>
                </div>
                <div class="skeleton-header">
                    <div class="skeleton skeleton-h2" style="width: 40%;"></div>
                    <div class="skeleton skeleton-h1"></div>
                </div>
                <div class="skeleton-actions">
                    <div class="skeleton skeleton-button"></div>
                    <div class="skeleton skeleton-button"></div>
                </div>
            </div>
        </div>

        <div class="container" id="main-container">
            <div class="course-actions" id="dynamic-course-actions"></div>
            <div class="course-header">
                <h2>Civil Engineering Department</h2>
                <h1>Class Timetable</h1>
                <div class="course-info">
                    <span class="info-item"><i class="far fa-clock fa-spin"></i><span
                            id="week-counter">Loading...</span></span>
                </div>
                <div class="progress-bar">
                    <div class="progress"></div>
                </div>
            </div>

            <form id="timetable-form" action="https://eis.epoka.edu.al/publictimetable" method="POST"
                target="timetable-iframe" style="display:none;">
                <input type="hidden" id="timetable-select" name="form[timetable]" value="">
                <input type="hidden" id="class-select" name="form[programGrade]" value="">
            </form>

            <div id="timetable-container" class="iframe-container"><iframe id="timetable-iframe"
                    name="timetable-iframe"></iframe></div>
            <div id="lecturer-container" class="iframe-container"><iframe id="lecturer-iframe"
                    name="lecturer-iframe"></iframe></div>
        </div>

        <footer class="footer">
            <div class="footer-tools">
                <button id="theme-toggle" class="theme-toggle" aria-label="Theme: Auto" title="Theme: Auto">
                    <i id="theme-toggle-icon" class="fas fa-adjust" aria-hidden="true"></i>
                </button>
            </div>
            <div class="social-links">
                <a href="https://eis.epoka.edu.al/cv/fullcv/655" target="_blank" rel="noopener noreferrer" title="CV"><i
                        class="far fa-id-card"></i></a>
                <a href="mailto:bplaku@epoka.edu.al" target="_blank" rel="noopener noreferrer" title="Email"><i
                        class="far fa-envelope"></i></a>
            </div>
            <p style="font-size:0.8em; text-transform: uppercase; letter-spacing: 2px; font-weight: 700;"><i
                    class="far fa-copyright"></i>
                2023–<span id="currentYear"></span> Bredli Plaku. All Rights Reserved.</p>
        </footer>
    </div>

    <div id="cat-companion">
        <div id="cat-speech-bubble"></div>
        <img id="cat-image" src="https://leunghoicheng.com/assets/hero-section-animation.gif"
            alt="A friendly cat companion">
    </div>

    <script>
        // --- Configuration & State ---
        const API_KEY = 'AIzaSyD295FTtMHvXxZablRf0f-FR-IQ2dQRPQE';
        const COURSE_MATERIALS_SPREADSHEET_ID = '1TFkw_hQWw_pvViy3i38VvzCwp4z5RL2SNZNgUVcjnNo';
        const SPINNER_GIFS = [
            '../gifs/loading.webp', '../gifs/loading_2.gif', '../gifs/loading_3.gif',
            '../gifs/loading_4.gif', '../gifs/loading_5.webp', '../gifs/loading_6.webp'
        ];
        const LOADING_TEXTS = ["Fetching deadlines...", "Aligning lecture halls...", "Polishing the timetable...", "Requesting more chalk...", "Waking up lecturers..."];
        let semesterInfo = { startDate: "2025-10-01", endDate: "2026-01-20", holidayWeeks: 0 };
        let currentTimetableId = null, currentClassId = null, currentLecturerKey = null;
        let textInterval;

        // --- Core Initialization ---
        function init() {
            updateYear();
            setupThemeToggle();
            setupCatCompanion();
            setupSwipeGestures();
            startLoadingAnimation();

            if (typeof gapi !== 'undefined') initGoogleApi();
            else window.addEventListener('google-api-ready', initGoogleApi);
        }

        function onGapiLoad() { window.dispatchEvent(new Event('google-api-ready')); }

        function initGoogleApi() {
            gapi.load('client', () => {
                gapi.client.init({
                    apiKey: API_KEY,
                    discoveryDocs: ["https://sheets.googleapis.com/$discovery/rest?version=v4"]
                }).then(loadAllData).catch(handleApiError);
            });
        }

        function handleApiError(error) {
            console.error('GAPI Error:', error);
            document.body.classList.remove('is-loading');
            clearInterval(textInterval);
        }

        async function loadAllData() {
            try {
                // 1. Fetch all settings data first
                const settings = await parseSettings();

                // 2. Use settings to render the UI
                renderSemesterInfo(settings);
                renderCourseInfo(settings.info_items);
                renderActionButtons(settings.action_buttons);

                // 3. Use the category map from settings to build the timetable section
                await renderDynamicCategories(settings.category_map);

                document.body.classList.remove('is-loading');
                clearInterval(textInterval);
            } catch (error) {
                handleApiError(error);
            }
        }

        // Renders week counter and progress bar
        function renderSemesterInfo(settings) {
            const startDate = settings.semester_start;
            const endDate = settings.semester_end;
            const holidayWeeks = parseInt(settings.holiday_weeks) || 0;

            if (startDate && endDate) {
                semesterInfo = { startDate, endDate, holidayWeeks };
                updateWeekCounter();
                updateProgress();
            }
        }

        // Renders dynamic info items
        function renderCourseInfo(infoItems) {
            const container = document.querySelector('.course-info');
            if (!container) return;
            infoItems.forEach(item => {
                const infoSpan = document.createElement('span');
                infoSpan.className = 'info-item';
                infoSpan.innerHTML = `<i class="${item.icon}"></i> ${item.text}`;
                container.appendChild(infoSpan);
            });
        }

        // Renders dynamic action buttons
        function renderActionButtons(actionButtons) {
            const container = document.getElementById('dynamic-course-actions');
            if (!container) return;
            container.innerHTML = ''; // Clear hard-coded buttons
            actionButtons.forEach(item => {
                const button = document.createElement('button');
                if (item.cssClass) button.className = item.cssClass;
                button.innerHTML = `<i class="${item.icon}"></i> ${item.action}`;
                button.onclick = () => window.open(item.url, '_self', 'noopener,noreferrer');
                container.appendChild(button);
            });
        }

        // Builds category buttons and fetches timetable data based on the map
        async function renderDynamicCategories(categoryMap) {
            const mainContainer = document.getElementById('main-container');
            const sheetNames = Object.keys(categoryMap);
            if (!sheetNames.length || !mainContainer) return;

            const buttonsContainer = document.createElement('div');
            buttonsContainer.className = 'category-buttons-container';

            const contentsWrapper = document.createElement('div');
            let isFirst = true;

            sheetNames.forEach(sheetName => {
                const categoryId = `${sheetName.toLowerCase().replace(/\s+/g, '-')}-content`;
                const icon = categoryMap[sheetName];

                const button = document.createElement('button');
                button.className = 'category-button';
                button.dataset.category = categoryId;
                button.innerHTML = `<i class="${icon}"></i> ${sheetName}`;
                if (isFirst) button.classList.add('active');
                buttonsContainer.appendChild(button);

                const contentDiv = document.createElement('div');
                contentDiv.id = categoryId;
                contentDiv.className = 'category-content';
                if (isFirst) contentDiv.classList.add('active');
                contentDiv.innerHTML = `<div class="timetable-buttons" id="${sheetName}-buttons"></div>`;
                contentsWrapper.appendChild(contentDiv);

                isFirst = false;
            });

            const form = document.getElementById('timetable-form');
            if (form) {
                mainContainer.insertBefore(buttonsContainer, form);
                mainContainer.insertBefore(contentsWrapper, form);
            }

            // Fetch data for all visible categories
            const ranges = sheetNames.map(name => name === 'Lecturers' ? `${name}!A2:B50` : `${name}!A2:C50`);
            const response = await gapi.client.sheets.spreadsheets.values.batchGet({
                spreadsheetId: COURSE_MATERIALS_SPREADSHEET_ID,
                ranges: ranges
            });

            response.result.valueRanges.forEach((rangeResult, index) => {
                const sheetName = sheetNames[index];
                const data = rangeResult.values || [];
                const type = sheetName === 'Lecturers' ? 'lecturer' : 'timetable';
                populateTimetableButtons(`${sheetName}-buttons`, data, type);
            });

            // Initialize UI elements now that they exist in the DOM
            setupCategoryButtons();
            initializeScrollFaders();
        }

        async function parseSettings() {
            const settings = {
                info_items: [],
                action_buttons: [],
                category_map: {}
            };
            const response = await gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: COURSE_MATERIALS_SPREADSHEET_ID,
                range: 'Settings!A:E'
            });
            const rows = response.result.values || [];
            rows.forEach(row => {
                const key = row[0];
                if (!key) return;

                switch (key) {
                    case 'semester_start':
                    case 'semester_end':
                    case 'holiday_weeks':
                        settings[key] = row[1];
                        break;
                    case 'info_item':
                        // Value 1: Label, Value 2: Icon, Value 3: Text
                        if (row[1] && row[2] && row[3]) {
                            settings.info_items.push({ label: row[1], icon: row[2], text: row[3] });
                        }
                        break;
                    case 'action_button':
                        // Value 1: Action, Value 2: Icon, Value 3: URL, Value 4: CSS Class
                        if (row[1] && row[2] && row[3]) {
                            settings.action_buttons.push({ action: row[1], icon: row[2], url: row[3], cssClass: row[4] || '' });
                        }
                        break;
                    case 'category_map':
                        // Value 1: Worksheet Name, Value 2: Icon
                        if (row[1] && row[2]) {
                            settings.category_map[row[1]] = row[2];
                        }
                        break;
                }
            });
            return settings;
        }

        async function parseSettings() {
            const settings = {
                info_items: [],
                action_buttons: [],
                category_map: {}
            };
            const response = await gapi.client.sheets.spreadsheets.values.get({
                spreadsheetId: COURSE_MATERIALS_SPREADSHEET_ID,
                range: 'Settings!A:E'
            });
            const rows = response.result.values || [];
            rows.forEach(row => {
                const key = row[0];
                if (!key) return;

                switch (key) {
                    case 'semester_start':
                    case 'semester_end':
                    case 'holiday_weeks':
                        settings[key] = row[1];
                        break;
                    case 'info_item':
                        // Value 1: Label, Value 2: Icon, Value 3: Text
                        if (row[1] && row[2] && row[3]) {
                            settings.info_items.push({ label: row[1], icon: row[2], text: row[3] });
                        }
                        break;
                    case 'action_button':
                        // Value 1: Action, Value 2: Icon, Value 3: URL, Value 4: CSS Class
                        if (row[1] && row[2] && row[3]) {
                            settings.action_buttons.push({ action: row[1], icon: row[2], url: row[3], cssClass: row[4] || '' });
                        }
                        break;
                    case 'category_map':
                        // Value 1: Worksheet Name, Value 2: Icon
                        if (row[1] && row[2]) {
                            settings.category_map[row[1]] = row[2];
                        }
                        break;
                }
            });
            return settings;
        }

        // Fetches all data from the 'Settings' worksheet at once
        async function loadSettingsData() {
            try {
                const ranges = ['Settings!A1:C2', 'Settings!E2:G20', 'Settings!I2:L20'];
                const response = await gapi.client.sheets.spreadsheets.values.batchGet({
                    spreadsheetId: COURSE_MATERIALS_SPREADSHEET_ID,
                    ranges: ranges,
                });

                const [semesterValues, infoValues, actionValues] = response.result.valueRanges;

                // 1. Process Semester Info (Week Counter & Progress Bar)
                const semesterRows = semesterValues.values;
                if (semesterRows && semesterRows.length > 1 && semesterRows[1][0] && semesterRows[1][1]) {
                    semesterInfo = { startDate: semesterRows[1][0], endDate: semesterRows[1][1], holidayWeeks: parseInt(semesterRows[1][2]) || 0 };
                    updateWeekCounter();
                    updateProgress();
                }

                // 2. Process and Render Dynamic Info Items
                const infoRows = infoValues.values || [];
                const courseInfoContainer = document.querySelector('.course-info');
                infoRows.filter(row => row[0] && row[1] && row[2]).forEach(row => {
                    const [label, icon, text] = row;
                    const infoItem = document.createElement('span');
                    infoItem.className = 'info-item';
                    infoItem.innerHTML = `<i class="${icon}"></i> ${text}`;
                    courseInfoContainer.appendChild(infoItem);
                });

                // 3. Process and Render Dynamic Course Actions
                const actionRows = actionValues.values || [];
                const actionsContainer = document.getElementById('dynamic-course-actions');
                if (actionsContainer) {
                    actionsContainer.innerHTML = ''; // Clear existing
                    actionRows.filter(row => row[0] && row[1] && row[2]).forEach(row => {
                        const [action, icon, url, cssClass] = row;
                        const button = document.createElement('button');
                        if (cssClass) button.className = cssClass;
                        button.innerHTML = `<i class="${icon}"></i> ${action}`;
                        button.onclick = () => window.open(url, '_blank', 'noopener,noreferrer');
                        actionsContainer.appendChild(button);
                    });
                }

            } catch (error) {
                console.error("Error fetching settings data:", error);
            }
        }

        // Builds the category buttons and timetable sections
        async function loadDynamicCategories(sheetNames) {
            const mainContainer = document.getElementById('main-container');
            if (!mainContainer) return;

            // Filter out sheets we don't want as categories
            const categorySheets = sheetNames.filter(name => name !== 'Settings');
            const timetableSheets = categorySheets.filter(name => name !== 'Lecturers');

            // Create HTML containers
            const buttonsContainer = document.createElement('div');
            buttonsContainer.className = 'category-buttons-container';

            const contentsWrapper = document.createElement('div');

            let isFirst = true;
            categorySheets.forEach(sheetName => {
                const categoryId = `${sheetName.toLowerCase().replace(/\s+/g, '-')}-content`;

                // Create Button
                const button = document.createElement('button');
                button.className = 'category-button';
                button.dataset.category = categoryId;
                button.innerHTML = sheetName; // Icon can be added here if needed
                if (isFirst) button.classList.add('active');
                buttonsContainer.appendChild(button);

                // Create Content Div
                const contentDiv = document.createElement('div');
                contentDiv.id = categoryId;
                contentDiv.className = 'category-content';
                if (isFirst) contentDiv.classList.add('active');
                contentDiv.innerHTML = `<div class="timetable-buttons" id="${sheetName}-buttons"></div>`;
                contentsWrapper.appendChild(contentDiv);

                isFirst = false;
            });

            // Inject created HTML into the DOM before the form
            const form = document.getElementById('timetable-form');
            if (form) {
                mainContainer.insertBefore(buttonsContainer, form);
                mainContainer.insertBefore(contentsWrapper, form);
            }

            // Now that HTML is in the DOM, fetch data for the timetables
            try {
                const ranges = [
                    ...timetableSheets.map(name => `${name}!A2:C50`), // Timetable sheets
                    'Lecturers!A2:B50' // Special lecturer sheet
                ];

                const response = await gapi.client.sheets.spreadsheets.values.batchGet({
                    spreadsheetId: COURSE_MATERIALS_SPREADSHEET_ID,
                    ranges: ranges
                });

                const valueRanges = response.result.valueRanges;

                // Populate timetables
                timetableSheets.forEach((sheetName, index) => {
                    const data = valueRanges[index].values || [];
                    populateTimetableButtons(`${sheetName}-buttons`, data, 'timetable');
                });

                // Populate lecturers (last item in ranges)
                const lecturerData = valueRanges[valueRanges.length - 1].values || [];
                populateTimetableButtons('Lecturers-buttons', lecturerData, 'lecturer');

                // Re-initialise event listeners and UI elements
                setupCategoryButtons();
                initializeScrollFaders();

            } catch (error) {
                console.error("Error fetching timetable data:", error);
            }
        }


        // A generic function to create timetable/lecturer buttons
        function populateTimetableButtons(containerId, data, type) {
            const container = document.getElementById(containerId);
            if (!container) return;
            container.innerHTML = '';

            (data || []).filter(row => row && row[0]).forEach(item => {
                const button = document.createElement('div');
                button.className = 'timetable-button';
                button.textContent = item[0];

                button.onclick = (e) => {
                    e.stopPropagation();
                    if (type === 'lecturer') {
                        loadIframeWithID(item[1], button);
                    } else {
                        loadTimetable(item[1], item[2], button);
                    }
                };
                container.appendChild(button);
            });
        }

        function startLoadingAnimation() {
            const spinner = document.getElementById('spinner-image');
            if (!spinner) return;
            let chosenGif = sessionStorage.getItem('spinnerGifUrl');
            if (!chosenGif) {
                chosenGif = SPINNER_GIFS[Math.floor(Math.random() * SPINNER_GIFS.length)];
                sessionStorage.setItem('spinnerGifUrl', chosenGif);
            }
            spinner.onload = () => spinner.classList.add('loaded');
            spinner.src = chosenGif;

            const textEl = document.getElementById('loading-text');
            if (!textEl) return;

            // --- New logic to pick one text per session, like the GIF ---
            let chosenText = sessionStorage.getItem('loadingText');
            if (!chosenText) {
                chosenText = LOADING_TEXTS[Math.floor(Math.random() * LOADING_TEXTS.length)];
                sessionStorage.setItem('loadingText', chosenText);
            }
            textEl.textContent = chosenText;
        }

        const calculateWeek = (start, end, holidays) => Math.min(Math.max(Math.ceil((new Date() - new Date(start)) / (7 * 24 * 60 * 60 * 1000)) - holidays, 1), Math.ceil((new Date(end) - new Date(start)) / (7 * 24 * 60 * 60 * 1000)));

        function updateWeekCounter() { document.getElementById('week-counter').textContent = `Week ${calculateWeek(semesterInfo.startDate, semesterInfo.endDate, semesterInfo.holidayWeeks)}`; }

        function updateProgress() {
            const progress = Math.min(Math.max((new Date() - new Date(semesterInfo.startDate)) / (new Date(semesterInfo.endDate) - new Date(semesterInfo.startDate)) * 100, 0), 100);
            document.querySelector('.progress').style.width = `${progress}%`;
        }

        function updateYear() { document.getElementById('currentYear').textContent = new Date().getFullYear(); }

        // --- UI Interactions ---
        function setupCategoryButtons() {
            document.querySelectorAll('.category-button').forEach(button => {
                button.addEventListener('click', e => {
                    e.stopPropagation();
                    document.querySelectorAll('.category-button').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    document.querySelectorAll('.category-content').forEach(c => c.classList.remove('active'));
                    document.getElementById(button.dataset.category).classList.add('active');
                    hideAllIframes();
                });
            });
        }

        const highlightActiveButton = clicked => {
            document.querySelectorAll('.timetable-button').forEach(btn => btn.classList.remove('active'));
            if (clicked) clicked.classList.add('active');
        };

        function hideAllIframes() {
            document.getElementById('timetable-container').classList.remove('active');
            document.getElementById('lecturer-container').classList.remove('active');
            highlightActiveButton(null);
            currentTimetableId = currentClassId = currentLecturerKey = null;
        }

        function loadTimetable(timetableVal, classVal, btn) {
            if (currentTimetableId === timetableVal && currentClassId === classVal) { hideAllIframes(); return; }
            document.getElementById('lecturer-container').classList.remove('active');
            document.getElementById('timetable-container').classList.add('active');
            document.getElementById('timetable-select').value = timetableVal;
            document.getElementById('class-select').value = classVal;
            document.getElementById('timetable-form').submit();
            currentTimetableId = timetableVal; currentClassId = classVal; currentLecturerKey = null;
            highlightActiveButton(btn);
        }

        function loadIframeWithID(id, btn) {
            if (id === "#") return;
            if (currentLecturerKey === id) { hideAllIframes(); return; }
            document.getElementById('timetable-container').classList.remove('active');
            document.getElementById('lecturer-iframe').src = `https://eis.epoka.edu.al/publictimetable/live/${id}`;
            document.getElementById('lecturer-container').classList.add('active');
            currentLecturerKey = id; currentTimetableId = currentClassId = null;
            highlightActiveButton(btn);
        }

        function setupSwipeGestures() {
            let touchStartX = 0, isScrolling = false;
            const swipeArea = document.body;
            swipeArea.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
                let target = e.target;
                isScrolling = false;
                while (target && target !== swipeArea) {
                    if (target.scrollWidth > target.clientWidth) { isScrolling = true; break; }
                    target = target.parentElement;
                }
            }, { passive: true });
            swipeArea.addEventListener('touchend', e => {
                if (isScrolling) return;
                const touchEndX = e.changedTouches[0].screenX;
                if (touchEndX < touchStartX - 50) navigate(1); // Swipe left
                if (touchEndX > touchStartX + 50) navigate(-1); // Swipe right
            }, { passive: true });

            const navigate = direction => {
                const isTimetableActive = currentTimetableId || currentLecturerKey;
                const selector = isTimetableActive ? '.category-content.active .timetable-button' : '.category-button';
                const buttons = Array.from(document.querySelectorAll(selector));
                if (buttons.length === 0) return;
                const currentIndex = buttons.findIndex(btn => btn.classList.contains('active'));
                const newIndex = (currentIndex + direction + buttons.length) % buttons.length;
                buttons[newIndex]?.click();
            };
        }

        function setupThemeToggle() {
            const BTN = document.getElementById('theme-toggle'), ICON = document.getElementById('theme-toggle-icon');
            if (!BTN || !ICON) return;

            const getSaved = () => localStorage.getItem('theme-preference') || 'auto';

            const applyTheme = (pref) => {
                const html = document.documentElement;
                if (pref === 'auto') {
                    html.removeAttribute('data-theme');
                } else {
                    html.setAttribute('data-theme', pref);
                }
                localStorage.setItem('theme-preference', pref);
                ICON.className = { auto: 'fas fa-adjust', light: 'far fa-sun', dark: 'far fa-moon' }[pref] || 'fas fa-adjust';
                BTN.title = `Theme: ${pref.charAt(0).toUpperCase() + pref.slice(1)}`;
            };

            BTN.addEventListener('click', (e) => {
                e.stopPropagation();
                const current = getSaved();
                const isSystemDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const newPref = current === 'auto' ? (isSystemDark ? 'light' : 'dark') : 'auto';
                applyTheme(newPref);
            });

            applyTheme(getSaved());
        }

        function updateScrollFaders(el) {
            const scrollable = el.scrollWidth > el.clientWidth + 1;
            el.classList.toggle('is-scrollable', scrollable);
            if (scrollable) {
                const atStart = el.scrollLeft < 5;
                const atEnd = el.scrollLeft + el.clientWidth >= el.scrollWidth - 5;
                el.classList.toggle('at-start', atStart && !atEnd);
                el.classList.toggle('at-end', atEnd && !atEnd);
            }
        }

        function initializeScrollFaders() {
            const containers = document.querySelectorAll('.category-buttons-container, .course-actions, .timetable-buttons, .course-info');
            containers.forEach(el => {
                if (el) {
                    updateScrollFaders(el);
                    el.addEventListener('scroll', () => updateScrollFaders(el), { passive: true });
                    new ResizeObserver(entries => entries.forEach(e => updateScrollFaders(e.target))).observe(el);
                }
            });
        }

        function setupCatCompanion() {
            const cat = document.getElementById('cat-companion');
            const bubble = document.getElementById('cat-speech-bubble');
            if (!cat || !bubble) return;

            let bubbleTimeout;
            let animationTimeout; // To handle the re-animation

            // These are the context-specific messages from your timetable page
            const messages = [
                // --- Productivity "Tips" ---
                "That's a lot of lectures back-to-back. Remember to schedule time for a nap. It's important.",
                "Is it 8:40 already? Your mechanics lecture is calling... or maybe just hit snooze.",
                "The key to productivity is a well-placed nap on the keyboard. It forces a mandatory break.",
                "Stuck on a problem? Try staring blankly at a wall for an hour. Works for me.",
                "Remember to stretch. I recommend the 'long cat' stretch across your entire desk.",
                "Your chair looks comfortable, but have you considered the floor? Or that small cardboard box? Peak ergonomics.",
                "You're still here? I admire your dedication. I would have taken a nap three lectures ago.",

                // --- Technical "Support" ---
                "Psst. I helped build this page... mostly by sitting on the keyboard.",
                "I'm not sleeping, I'm compiling. It's a very complex process.",
                "The Wi-Fi is slow because the waves have to travel around me. I am a significant physical object.",
                "Your computer is warm. This is good. It is performing its primary function as a heated bed.",
                "I have de-bugged your code by chasing the cursor. You're welcome.",
                "I've optimized the CSS. By sleeping on the warm laptop, I prevented the human from adding more `!important` tags.",

                // --- Philosophical Musings ---
                "The human is processing requests. I am processing the structural integrity of this cardboard box. We are both very busy.",
                "If I fits, I sits. This is the first law of feline physics.",
                "To nap, or not to nap? That is the question. And the answer is always to nap.",
                "The meaning of life is finding the perfect sunbeam. Everything else is just... filler.",
                "My bones are merely a suggestion. It allows for optimal napping positions.",
                "I think, therefore I am... sleepy.",

                // --- General Sass & Commentary ---
                "Professor, your timetable seems... full. Might I suggest delegating a lecture to me? I'm an expert on the thermodynamics of sunbeams.",
                "A material request? Let me guess, you need more... tuna? No? Just chalk? Boring. 🙄",
                "I've reviewed your material request. Approved. On the condition of extra biscuits.",
                "My human thinks they're in charge. It's quite adorable, isn't it?",
                "Go on, click me again. I dare you.",
                "That clicking sound from your keyboard is disrupting my nap. Please type softer.",
                "Are you going to finish that? ...is a question I am always prepared to ask.",
                "I see the food bowl is only 98% full. We need to talk about these service levels.",
                "You work hard so I can live a life of leisure. I appreciate your contribution to my well-being.",
                "Alert! The red dot has been sighted. All other tasks are now low priority.",
                "Don't worry, I'm supervising. Every click you make is being carefully monitored from this very comfortable spot.",
                "Did you know the optimal number of monitors is two? One for work, and one for me to sit in front of.",

                // --- Friendly & Random ---
                "Checking your timetable? Don't forget to pencil me in for head scratches.",
                "Blinking slowly at you. That's a sign of trust, you know.",
                "Need a study buddy? I'm available for moral support, provided it doesn't involve moving.",
                "Sunbeam detected on the floor. Relocating to primary charging station.",
                "I've brought you a gift. It's my favourite bottle cap. Do not lose it.",
                "Kalofsh një ditë të bukur!",
                "Mirë se vjen!"
            ];

            cat.addEventListener('click', (event) => {
                event.stopPropagation();

                // --- NEW ANIMATION LOGIC ---
                clearTimeout(bubbleTimeout);
                clearTimeout(animationTimeout);

                // 1. Always hide the bubble first to reset its state.
                bubble.classList.remove('visible');

                // 2. Use a short timeout for a smooth hide-then-show effect.
                animationTimeout = setTimeout(() => {
                    const randomIndex = Math.floor(Math.random() * messages.length);
                    bubble.textContent = messages[randomIndex];
                    bubble.classList.add('visible'); // Re-triggers the "show" animation
                }, 100);

                // 3. Set the timer to hide the bubble after 6 seconds.
                bubbleTimeout = setTimeout(() => {
                    bubble.classList.remove('visible');
                }, 6000);
            });

            // Hides the bubble when clicking anywhere else on the page
            document.addEventListener('click', () => {
                if (bubble.classList.contains('visible')) {
                    bubble.classList.remove('visible');
                }
            });
        }

        window.addEventListener('load', init);
    </script>
</body>

</html>